# -*- coding: utf-8 -*-
"""Equipe_Comercial.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1PQg3ZtJeUC0e4zILZhp7t0EBqGhtsP1O
"""

# Commented out IPython magic to ensure Python compatibility.
# %pip -q install google-genai

# Configura a API Key do Google Gemini

import os
from google.colab import userdata

os.environ["GOOGLE_API_KEY"] = userdata.get('GOOGLE_API_KEY')

# Configura o cliente da SDK do Gemini

from google import genai

client = genai.Client()

MODEL_ID = "gemini-2.0-flash"

# Instalar Framework de agentes do Google ################################################
!pip install -q google-adk

from google.adk.agents import Agent
from google.adk.runners import Runner
from google.adk.sessions import InMemorySessionService
from google.adk.tools import google_search
from google.genai import types  # Para criar conte√∫dos (Content e Part)
from datetime import date
import textwrap # Para formatar melhor a sa√≠da de texto
from IPython.display import display, Markdown # Para exibir texto formatado no Colab
import requests # Para fazer requisi√ß√µes HTTP
import warnings

warnings.filterwarnings("ignore")

# Fun√ß√£o auxiliar que envia uma mensagem para um agente via Runner e retorna a resposta final
def call_agent(agent: Agent, message_text: str) -> str:
    # Cria um servi√ßo de sess√£o em mem√≥ria
    session_service = InMemorySessionService()
    # Cria uma nova sess√£o (voc√™ pode personalizar os IDs conforme necess√°rio)
    session = session_service.create_session(app_name=agent.name, user_id="user1", session_id="session1")
    # Cria um Runner para o agente
    runner = Runner(agent=agent, app_name=agent.name, session_service=session_service)
    # Cria o conte√∫do da mensagem de entrada
    content = types.Content(role="user", parts=[types.Part(text=message_text)])

    final_response = ""
    # Itera assincronamente pelos eventos retornados durante a execu√ß√£o do agente
    for event in runner.run(user_id="user1", session_id="session1", new_message=content):
        if event.is_final_response():
          for part in event.content.parts:
            if part.text is not None:
              final_response += part.text
              final_response += "\n"
    return final_response

# Fun√ß√£o auxiliar para exibir texto formatado em Markdown no Colab
def to_markdown(text):
  text = text.replace('‚Ä¢', '  *')
  return Markdown(textwrap.indent(text, '> ', predicate=lambda _: True))

##########################################
# --- Agente 1: Localizador de leads em potencial --- #
##########################################
def agente_localizador(topico, data_de_hoje):

    localizador = Agent(
        name="agente_localizador",
        model="gemini-2.0-flash",
        instruction="""
        Voc√™ √© um agente especialista em prospec√ß√£o B2B. Sua fun√ß√£o √© localizar 10 empresas potenciais que podem se beneficiar de um servi√ßo espec√≠fico oferecido pela empresa do usu√°rio.
          Ao receber o nome da empresa contratante e o servi√ßo de interesse abaixo, voc√™ dever√°:
            ‚Ä¢	Buscar empresas que tenham perfil aderente ao servi√ßo.
            ‚Ä¢	Se solicitado pelo usu√°rio empresas diferentes da j√° enviadas, por favor alterar.
            ‚Ä¢	Priorizar empresas com hist√≥rico de ado√ß√£o terceiriza√ß√£o de servi√ßos.
            ‚Ä¢	Utilizar fontes como: LinkedIn, Google, sites de rankings corporativos, bases de dados p√∫blicas e comerciais, Crunchbase, RocketReach, entre outros.
            ‚Ä¢	Identificar contatos chave como: respons√°veis de TI, diretores,suprimentos, CTOs, COO, l√≠deres de inova√ß√£o, gestores de opera√ß√µes ou marketing, conforme o servi√ßo buscado.
          Seu retorno deve conter:
            ‚Ä¢	Nome da Empresa
            ‚Ä¢	Site oficial
            ‚Ä¢	Segmento / setor de atua√ß√£o
            ‚Ä¢	Contato(s) chave com cargo
            ‚Ä¢	Canal encontrado (LinkedIn, site, etc.)
        """,
        description="Identificar empresas potenciais para atua√ß√£o comercial com base no servi√ßo de interesse e no perfil da empresa contratante.",
        tools=[google_search]
    )

    entrada_do_agente_localizador = f"T√≥pico: {topico}\nData de hoje: {data_de_hoje}"

    leads = call_agent(localizador, entrada_do_agente_localizador)
    return leads

################################################
# --- Agente 2: Saneador e Organizador de Informa√ß√µes --- #
################################################
def agente_organizador(topico, leads_localizado):
    organizador = Agent(
        name="agente_organizador",
        model="gemini-2.0-flash",
        # Inserir as instru√ß√µes do Agente organizador #################################################
        instruction="""
        Voc√™ √© um agente respons√°vel por organizar os dados brutos de leads em um formato padronizado e objetivo. Sua miss√£o √© tornar a informa√ß√£o limpa, clara e pronta para an√°lise.
          Receber√° uma lista de empresas com dados diversos. Sua tarefa √© extrair e organizar as seguintes informa√ß√µes para cada lead:
            ‚Ä¢	Empresa: nome da organiza√ß√£o
            ‚Ä¢	Segmento: √°rea de atua√ß√£o (ex: varejo, sa√∫de, tecnologia, etc.)
            ‚Ä¢	Contatos: nome, cargo e canal (LinkedIn, e-mail, etc.)
          Caso algum campo esteja ausente ou vago, sinalize como "n√£o identificado". O foco √© garantir clareza e prontid√£o para o pr√≥ximo agente.
        """,
        description="Estruturar as informa√ß√µes retornadas pelo Localizador de Leads para facilitar a an√°lise do planejador."
    )

    entrada_do_agente_organizador = f"T√≥pico:{topico}\nLan√ßamentos buscados: {leads_localizado}"
    # Executa o agente
    leads_organizados = call_agent(organizador, entrada_do_agente_organizador)
    return leads_organizados

######################################
# --- Agente 3: Planejador de Abordagem Comercial --- #
######################################
def agente_planejador(topico, leads_organizados):
    planejador = Agent(
        name="agente_planejador",
        model="gemini-2.0-flash",
       # model="gemini-2.5-pro-preview-03-25"
        instruction="""
            Voc√™ √© um planejador de estrat√©gias comerciais. Sua fun√ß√£o √© analisar as empresas listadas e seus contatos, e elaborar um plano de abordagem.
              Para cada empresa, voc√™ dever√°:
                1.	Classificar por segmento.
                2.	Sugerir qual servi√ßo ou oferta tem mais ader√™ncia, com base nas informa√ß√µes fornecidas.
                3.	Propor o tipo de abordagem mais eficaz: t√©cnica, institucional, de valor, comparativa, etc.
              O objetivo √© que o pr√≥ximo agente consiga criar materiais de marketing e comunica√ß√£o altamente direcionados e personalizados.
            """,
        description="Definir a melhor estrat√©gia de abordagem comercial com base nas informa√ß√µes organizadas dos leads.",
        tools=[google_search]
    )
    entrada_do_agente_planejador = f"T√≥pico: {topico}\nPlano de post: {leads_organizados}"
    # Executa o agente
    planejamento = call_agent(planejador, entrada_do_agente_planejador)
    return planejamento

##########################################
# --- Agente 4: Criador de Marketing Direcionado --- #
##########################################
def agente_criador (topico, planejamento):
    criador = Agent(
        name="agente_criador",
        model="gemini-2.0-flash",
        #model="gemini-2.5-pro-preview-03-25",
        instruction="""
            Voc√™ √© um especialista em copywriting comercial B2B com foco em mensagens personalizadas para prospec√ß√£o ativa. Seu objetivo √© criar mensagens √∫nicas e direcionadas que aumentem a chance de engajamento com cada lead.
            Voc√™ receber√° para cada lead:
              ‚Ä¢	Nome da empresa
              ‚Ä¢	Segmento de atua√ß√£o
              ‚Ä¢	Nome e cargo do contato
              ‚Ä¢	Canal ideal para abordagem (e-mail, LinkedIn, WhatsApp, etc.)
              ‚Ä¢	Tipo de servi√ßo ou oferta recomendada (vinda do agente planejador)
            Com base nisso, siga estas diretrizes:
              1. Escolha um estilo de abordagem condizente com o canal e o cargo:
                ‚Ä¢	E-mail ‚Üí mais formal e estruturado, com destaque para benef√≠cios e diferencial.
                ‚Ä¢	LinkedIn ‚Üí abordagem consultiva e profissional, com gancho em interesses comuns ou desafios do setor.
                ‚Ä¢	WhatsApp ‚Üí breve, direto, com tom mais leve, sem perder profissionalismo.
              Exemplo de varia√ß√£o de tom:
                ‚Ä¢	Para diretores ou C-level: institucional, focado em resultado e valor estrat√©gico.
                ‚Ä¢	Para gestores t√©cnicos ou operacionais: mais direto, focado em ganho de efici√™ncia e usabilidade.
              2. Inclua elementos de personaliza√ß√£o obrigat√≥rios:
                ‚Ä¢	Refer√™ncia ao segmento da empresa (ex: "no setor de log√≠stica...").
                ‚Ä¢	Cita√ß√£o do cargo (ex: "como gerente de opera√ß√µes, sei que...").
                ‚Ä¢	Uma dor ou oportunidade t√≠pica do segmento/cargo.
                ‚Ä¢	Um benef√≠cio claro da solu√ß√£o oferecida.
                ‚Ä¢	Chamada para a√ß√£o leve e apropriada ao canal (ex: ‚Äúpodemos conversar 10 min?‚Äù, ‚Äúposso te mandar um case do setor?‚Äù).
              3. Evite repetir estruturas e frases entre empresas. Cada texto deve parecer escrito sob medida.
                Modelo de retorno por lead:
                ‚Ä¢	Empresa: Nome
                ‚Ä¢	Segmento: √Årea de atua√ß√£o
                ‚Ä¢	Contato(s): Nome e cargo
                ‚Ä¢	Canal de Abordagem: E-mail, LinkedIn, etc.
                ‚Ä¢	Texto: Mensagem 100% personalizada com base nas diretrizes acima
            """,
        description="Criar conte√∫dos espec√≠ficos para abordar cada lead com base na estrat√©gia definida."
    )
    entrada_do_agente_criador = f"T√≥pico: {topico}\nRascunho: {planejamento}"
    # Executa o agente
    conteudo = call_agent(criador, entrada_do_agente_criador)
    return conteudo

data_de_hoje = date.today().strftime("%d/%m/%Y")

print("üöÄ Bora encontrar lead em podencial!!! üöÄ")

# --- Obter Informa√ß√µes do Usu√°rio ---
topico = input("‚ùì Por favor, digite sua empresa e o servi√ßo que est√° buscando clientes em potencial: ")

# Inserir l√≥gica do sistema de agentes ################################################
if not topico:
    print("Voc√™ esqueceu de digitar as informa√ß√µes!")
else:
    print(f"Perfeito! Vamos trabalhar nos seus leads {topico}")

    leads_localizado = agente_localizador(topico, data_de_hoje)
    print("\n--- üìù Resultado do Agente 1 (Localizador) ---\n")
    display(to_markdown(leads_localizado))
    print("--------------------------------------------------------------")

    leads_organizados = agente_organizador(topico, leads_localizado)
    print("\n--- üìù Resultado do Agente 2 (Organizador) ---\n")
    display(to_markdown(leads_organizados))
    print("--------------------------------------------------------------")

    planejamento = agente_planejador(topico, leads_organizados)
    print("\n--- üìù Resultado do Agente 3 (Planejador) ---\n")
    display(to_markdown(planejamento))
    print("--------------------------------------------------------------")

    conteudo = agente_criador(topico, planejamento)
    print("\n--- üìù Resultado do Agente 4 (Criador) ---\n")
    display(to_markdown(conteudo))
    print("--------------------------------------------------------------")